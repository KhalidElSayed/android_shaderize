
precision mediump float;

uniform float uSteps;
uniform sampler2D sTexturePass1;
uniform vec2 uDelta0;
varying vec2 vTextureCoord;

void main() {
	float sum = 1.0;
	vec2 textureCoord0 = vTextureCoord;
	gl_FragColor = texture2D(sTexturePass1, vTextureCoord);
	float coc = gl_FragColor.a;
	for (float t = 1.0; coc * uSteps >= t; ++t) {
		textureCoord0 += uDelta0;
		vec4 sample = texture2D(sTexturePass1, textureCoord0);
		if (sample.a * uSteps >= t) {
			gl_FragColor += sample;
			sum += 1.0;
		}
	}
	gl_FragColor /= sum;
}
